<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luna - Gerenciador de Filas</title>
  <!-- Atualizado para carregar o arquivo de estilos correto -->
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <!--
    Definimos aqui a URL base do backend (API) utilizada pelo front-end.
    Quando o frontend está hospedado em um domínio diferente do backend (por exemplo,
    o frontend no Vercel e o backend na Railway), as chamadas HTTP feitas com
    caminhos relativos ("/api/...") resultam em erros 404. Para corrigir isso,
    você pode definir window.API_BASE_URL com a URL completa do seu backend.

    Se o frontend e o backend estiverem no mesmo domínio, mantenha a variável
    abaixo vazia (""), e o navegador fará as chamadas relativas corretamente.

    IMPORTANTE: substitua o valor entre aspas pelo endereço real do seu servidor
    na Railway ou outra plataforma de hospedagem, incluindo o protocolo (http ou
    https). Exemplo:
      window.API_BASE_URL = "https://luna-pg-admin-back-production.up.railway.app";
  -->
  <script>
    // URL base da API (backend). Substitua pela sua URL ou deixe vazio se for a mesma origem.
    window.API_BASE_URL = "https://luna-pg-admin-back-production.up.railway.app";
  </script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="logo">Luna</h1>
      <div class="header-actions">
        <button id="refresh-btn" class="btn-icon" aria-label="Atualizar clientes">
          <i data-lucide="refresh-cw"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>Clientes</h2>
        <button id="toggle-sidebar" class="btn-icon" aria-label="Toggle sidebar">
          <i data-lucide="menu"></i>
        </button>
      </div>

      <!-- Search Clients -->
      <div class="search-box">
        <i data-lucide="search"></i>
        <input type="text" id="client-search" placeholder="Buscar clientes..." aria-label="Buscar clientes">
      </div>

      <!-- Client List -->
      <div class="client-list" id="client-list" role="list">
        <!-- Populated by JS -->
      </div>

      <!-- New Client Form -->
      <div class="new-client-form">
        <h3>Novo Cliente</h3>
        <form id="new-client-form">
          <input type="text" id="new-client-slug" placeholder="Ex: joana" required aria-label="Slug do cliente">
          <button type="submit" class="btn btn-primary">
            <i data-lucide="plus"></i>
            Criar Cliente
          </button>
        </form>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
      <div class="empty-state" id="empty-state">
        <i data-lucide="users"></i>
        <p>Selecione um cliente para começar</p>
      </div>

      <div class="client-view" id="client-view" style="display: none;">
        <!-- Client Header -->
        <div class="client-header">
          <h2 id="client-title">Cliente</h2>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-icon" style="background: var(--accent);">
              <i data-lucide="database"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-label">Totais</div>
              <div class="kpi-value" id="kpi-totais">0</div>
            </div>
          </div>

          <div class="kpi-card">
            <div class="kpi-icon" style="background: var(--accent);">
              <i data-lucide="check-circle"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-label">Enviados</div>
              <div class="kpi-value" id="kpi-enviados">0</div>
            </div>
          </div>

          <div class="kpi-card">
            <div class="kpi-icon" style="background: var(--accent);">
              <i data-lucide="list"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-label">Na Fila</div>
              <div class="kpi-value" id="kpi-fila">0</div>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" data-tab="queue">
            <i data-lucide="list"></i>
            Fila
          </button>
          <button class="tab" data-tab="totals">
            <i data-lucide="database"></i>
            Totais
          </button>
          <button class="tab" data-tab="add-contact">
            <i data-lucide="user-plus"></i>
            Adicionar Contato
          </button>
          <button class="tab" data-tab="import-csv">
            <i data-lucide="upload"></i>
            Importar CSV
          </button>
        </div>

        <!-- Tab Content: Queue -->
        <div class="tab-content active" id="tab-queue">
          <div class="table-controls">
            <div class="search-box">
              <i data-lucide="search"></i>
              <input type="text" id="queue-search" placeholder="Buscar na fila...">
            </div>
          </div>

          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Telefone</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="queue-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>

          <div class="pagination" id="queue-pagination">
            <button class="btn-icon" id="queue-prev" aria-label="Página anterior">
              <i data-lucide="chevron-left"></i>
            </button>
            <span id="queue-page-info">Página 1</span>
            <button class="btn-icon" id="queue-next" aria-label="Próxima página">
              <i data-lucide="chevron-right"></i>
            </button>
          </div>
        </div>

        <!-- Tab Content: Totals -->
        <div class="tab-content" id="tab-totals">
          <div class="table-controls">
            <div class="search-box">
              <i data-lucide="search"></i>
              <input type="text" id="totals-search" placeholder="Buscar no histórico...">
            </div>
            <select id="totals-filter" class="filter-select">
              <option value="all">Todos</option>
              <option value="sim">Enviados</option>
              <option value="nao">Pendentes</option>
            </select>
          </div>

          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Telefone</th>
                  <th>Nicho</th>
                  <th>Status</th>
                  <th>Atualizado</th>
                </tr>
              </thead>
              <tbody id="totals-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>

          <div class="pagination" id="totals-pagination">
            <button class="btn-icon" id="totals-prev" aria-label="Página anterior">
              <i data-lucide="chevron-left"></i>
            </button>
            <span id="totals-page-info">Página 1</span>
            <button class="btn-icon" id="totals-next" aria-label="Próxima página">
              <i data-lucide="chevron-right"></i>
            </button>
          </div>
        </div>

        <!-- Tab Content: Add Contact -->
        <div class="tab-content" id="tab-add-contact">
          <div class="form-card">
            <h3>Adicionar Novo Contato</h3>
            <form id="add-contact-form">
              <div class="form-group">
                <label for="contact-name">Nome</label>
                <input type="text" id="contact-name" required placeholder="Nome do contato">
              </div>
              <div class="form-group">
                <label for="contact-phone">Telefone</label>
                <input type="tel" id="contact-phone" required placeholder="(00) 00000-0000">
              </div>
              <div class="form-group">
                <label for="contact-niche">Nicho (opcional)</label>
                <input type="text" id="contact-niche" placeholder="Ex: Tecnologia">
              </div>
              <button type="submit" class="btn btn-primary">
                <i data-lucide="user-plus"></i>
                Adicionar Contato
              </button>
            </form>
          </div>
        </div>

        <!-- Tab Content: Import CSV -->
        <div class="tab-content" id="tab-import-csv">
          <div class="form-card">
            <h3>Importar Contatos via CSV</h3>
            <div class="import-actions">
              <button id="download-template" class="btn btn-secondary">
                <i data-lucide="download"></i>
                Baixar Modelo CSV
              </button>
            </div>

            <form id="import-csv-form">
              <div class="form-group">
                <label for="csv-file">Arquivo CSV</label>
                <div class="file-input-wrapper">
                  <input type="file" id="csv-file" accept=".csv" required>
                  <div class="file-input-display">
                    <i data-lucide="upload"></i>
                    <span id="file-name">Selecione um arquivo CSV</span>
                  </div>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i data-lucide="upload"></i>
                Importar CSV
              </button>
            </form>

            <div id="import-result" class="import-result" style="display: none;">
              <h4>Resultado da Importação</h4>
              <div class="result-stats">
                <div class="result-stat success">
                  <i data-lucide="check-circle"></i>
                  <span id="import-inserted">0</span> inseridos
                </div>
                <div class="result-stat warning">
                  <i data-lucide="alert-circle"></i>
                  <span id="import-skipped">0</span> ignorados
                </div>
                <div class="result-stat error">
                  <i data-lucide="x-circle"></i>
                  <span id="import-errors">0</span> erros
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for Queue Actions -->
  <div class="modal" id="queue-action-modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Confirmar Ação</h3>
        <button class="btn-icon" id="modal-close" aria-label="Fechar">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <p id="modal-message">Tem certeza?</p>
        <div class="checkbox-group" id="mark-sent-checkbox" style="display: none;">
          <label>
            <input type="checkbox" id="mark-as-sent">
            <span>Marcar como enviada</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="modal-cancel">Cancelar</button>
        <button class="btn btn-danger" id="modal-confirm">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container" aria-live="polite"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" style="display: none;">
    <div class="spinner"></div>
  </div>

  <!-- Atualizado para carregar o arquivo JavaScript correto -->
  <script type="module" src="app.js"></script>
</body>
</html>
